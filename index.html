<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Enhanced Countdown Timer</title>
  <style>
    :root {
      --bg-light: #f0f8ff;
      --bg-dark: #1e1e2f;
      --text-light: #000;
      --text-dark: #fff;
      --accent: #00aaff;
    }

    body {
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
      padding: 20px;
      background-color: var(--bg-light);
      color: var(--text-light);
      transition: background 0.3s, color 0.3s;
    }

    body.dark {
      background-color: var(--bg-dark);
      color: var(--text-dark);
    }

    h1 {
      text-align: center;
      font-size: 2.5em;
    }

    .controls {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
      margin-bottom: 20px;
    }

    input, select, button {
      padding: 10px;
      font-size: 1em;
      border-radius: 5px;
      border: none;
    }

    button {
      background-color: var(--accent);
      color: white;
      cursor: pointer;
    }

    button:hover {
      background-color: #0077cc;
    }

    .countdown {
      display: flex;
      justify-content: center;
      gap: 15px;
      flex-wrap: wrap;
      margin-top: 20px;
    }

    .card {
      background-color: rgba(0, 170, 255, 0.1);
      padding: 20px;
      border-radius: 10px;
      text-align: center;
      min-width: 100px;
      animation: pulse 1s infinite ease-in-out;
    }

    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }

    .label {
      font-size: 0.8em;
      margin-top: 5px;
    }

    .theme-toggle {
      position: absolute;
      top: 20px;
      right: 20px;
    }

    .milestones {
      text-align: center;
      margin-top: 20px;
    }

    .milestones li {
      margin: 5px 0;
    }

    .embed-tools {
      text-align: center;
      margin-top: 30px;
    }

    .embed-tools textarea {
      width: 90%;
      height: 80px;
      margin-top: 10px;
      font-size: 0.9em;
      padding: 10px;
      border-radius: 5px;
      border: 1px solid #ccc;
      resize: none;
    }

    iframe#preview {
      width: 90%;
      height: 300px;
      border: 1px solid #ccc;
      margin-top: 20px;
      border-radius: 5px;
    }

    #qrcode {
      margin-top: 20px;
    }

    @media (max-width: 600px) {
      h1 { font-size: 1.8em; }
      .card { min-width: 80px; }
    }
  </style>
</head>
<body>
  <button class="theme-toggle" onclick="toggleTheme()">Toggle Theme</button>
  <h1>Enhanced Countdown Timer</h1>
  <div class="controls">
    <input type="text" id="eventName" placeholder="Event Name (e.g. Birthday ðŸŽ‰)" />
    <input type="text" id="eventTimeText" placeholder="e.g. next Friday 5pm" />
    <select id="themeSelect">
      <option value="light">Light</option>
      <option value="dark">Dark</option>
    </select>
    <button onclick="startCountdown()">Start</button>
  </div>

  <ul class="milestones" id="milestoneList"></ul>
  <div class="countdown" id="countdownDisplay"></div>

  <div class="embed-tools">
    <button onclick="generateEmbedCode()">Generate Embed Code</button>
    <button onclick="sharePage(event)">Share This Countdown</button>
    <button onclick="generateQRCode()">Generate QR Code</button>
    <button onclick="downloadQRCode()">Download QR Code</button>
    <textarea id="embedOutput" readonly></textarea>
    <iframe id="preview"></iframe>
    <div id="qrcode"></div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/luxon@3/build/global/luxon.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

  <script>
    let countdownInterval;

    function toggleTheme() {
      document.body.classList.toggle('dark');
    }

    function parseNaturalDate(text) {
      try {
        return luxon.DateTime.fromJSDate(new Date(text));
      } catch {
        return null;
      }
    }

    function startCountdown() {
      clearInterval(countdownInterval);
      const name = document.getElementById('eventName').value.trim();
      const inputText = document.getElementById('eventTimeText').value.trim();
      const theme = document.getElementById('themeSelect').value;

      if (!inputText) {
        alert('Please enter a valid time like "next Friday 5pm".');
        return;
      }

      const eventTime = parseNaturalDate(inputText);
      if (!eventTime || eventTime < luxon.DateTime.now()) {
        alert('Please enter a future time.');
        return;
      }

      document.body.className = theme;

      const milestones = [
        { label: '1 Week Left', time: eventTime.minus({ days: 7 }) },
        { label: '3 Days Left', time: eventTime.minus({ days: 3 }) },
        { label: '1 Hour Left', time: eventTime.minus({ hours: 1 }) }
      ];

      countdownInterval = setInterval(() => {
        const now = luxon.DateTime.now();
        const diff = eventTime.diff(now, ['days', 'hours', 'minutes', 'seconds']).toObject();

        if (eventTime <= now) {
          document.getElementById('countdownDisplay').innerHTML = `<h2>${name || 'Event'} Started!</h2>`;
          confetti();
          clearInterval(countdownInterval);
          return;
        }

        document.getElementById('countdownDisplay').innerHTML = `
          <div class="card">${Math.floor(diff.days)}<div class="label">Days</div></div>
          <div class="card">${Math.floor(diff.hours)}<div class="label">Hours</div></div>
          <div class="card">${Math.floor(diff.minutes)}<div class="label">Minutes</div></div>
          <div class="card">${Math.floor(diff.seconds)}<div class="label">Seconds</div></div>
        `;

        const milestoneList = milestones
          .filter(m => m.time > now && m.time.diff(now, 'minutes').toObject().minutes < 1)
          .map(m => `<li>${m.label} ðŸŽ¯</li>`)
          .join('');
        document.getElementById('milestoneList').innerHTML = milestoneList;
      }, 1000);
    }

    function generateEmbedCode() {
      const url = window.location.href;
      const embed = `<iframe src="${url}" width="100%" height="540" style="border:0;" sandbox="allow-scripts allow-same-origin"></iframe>`;
      document.getElementById('embedOutput').value = embed;
      document.getElementById('preview').src = url;
    }

    function sharePage(event) {
      const btn = event.target;
      navigator.clipboard.writeText(window.location.href)
        .then(() => {
          btn.textContent = "Copied!";
          setTimeout(() => btn.textContent = "Share This Countdown", 2000);
        })
        .catch(() => alert("Failed to copy URL."));
    }

    function generateQRCode() {
      const url = window.location.href;
      const qrContainer = document.getElementById("qrcode");
      qrContainer.innerHTML = "";
      new QRCode(qrContainer, {
        text: url,
        width: 200,
        height: 200,
        colorDark: "#000000",
        colorLight: "#ffffff",
        correctLevel: QRCode.CorrectLevel.H
      });
    }

    function downloadQRCode() {
      const qrCanvas = document.querySelector("#qrcode canvas");
      if (!qrCanvas)  {
        alert("Please generate the QR code first.");
        return;
      }
    }
      